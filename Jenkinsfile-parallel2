def label_scm = "mypod-${UUID.randomUUID().toString()}"


parameters {
	string(name: 'buid_id', defaultValue: "${env.BUILD_NUMBER}", description: 'What should I say?')
  }


podTemplate(label: label_scm,cloud: "kubernetes",containers: [containerTemplate(name: 'maven', image: 'maven:3.8.4-jdk-8',command: 'sleep', args: '99d')]
	,volumes: [configMapVolume(configMapName: 'setting.xml', mountPath: '/config')]
    ){
    
    
    node(label_scm){
    	stage('get all deploy'){
		 git credentialsId: 'github', url: 'git@github.com:jackbauer123/mytest.git'	
                      container('maven') {
		      		
		      		sh 'mvn -B -ntp clean package -DskipTests -s /config/setting.xml'
				sh 'mvn install nxrm3:staging-deploy  -s /config/setting.xml'
				sh 'mvn deploy -s /config/setting.xml'
				
                  		
                        }
	}
    }	
	
	


}


