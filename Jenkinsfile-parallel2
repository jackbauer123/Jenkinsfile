def label_scm = "mypod-${UUID.randomUUID().toString()}"


parameters {
	string(name: 'buid_id', defaultValue: "${env.BUILD_NUMBER}", description: 'What should I say?')
  }


podTemplate(label: label_scm,cloud: "kubernetes",containers: [containerTemplate(name: 'maven', image: 'maven:3.8.4-jdk-8',command: 'sleep', args: '99d')]
	,volumes: [configMapVolume(configMapName: 'settings.xml', mountPath: '/usr/share/maven/ref/settings.xml')]
    ){
    
    
   parallel ( 
        
        "storage":  { 
            	node(label_scm) {
                    stage('build storage'){
                      git credentialsId: 'github', url: 'git@github.com:jackbauer123/mytest.git'	
                      container('maven') {
		      		
		      		sh 'mvn -B -ntp clean package -DskipTests -pl samples-common'
                  		sh 'mvn install -pl samples-common '
                          	sh 'mvn -B -ntp clean package -DskipTests  -pl io.seata:samples-storage'
                        }
                       }


		          }

        },
         "account": {
              node(label_scm) {
                    stage('build account'){
                        git credentialsId: 'github', url: 'git@github.com:jackbauer123/mytest.git'	
                        container('maven') {
				sh 'mvn -B -ntp clean package -DskipTests -pl samples-common '
                 		sh 'mvn install -pl samples-common '
                          	sh 'mvn -B -ntp clean package -DskipTests -pl io.seata:samples-account'
                        }
                     }


              }
	      }	,
         "order": {
              node(label_scm) {
                    stage('build order'){
                        git credentialsId: 'github', url: 'git@github.com:jackbauer123/mytest.git'	
                        container('maven') {
				sh 'mvn -B -ntp clean package -DskipTests -pl samples-common '
                 		sh 'mvn install -pl samples-common '
                          	sh 'mvn -B -ntp clean package -DskipTests -pl  io.seata:samples-order'
                        }
                     }


              }
	      }	,
         "logic": {
              node(label_scm) {
                    stage('build logic'){
                        git credentialsId: 'github', url: 'git@github.com:jackbauer123/mytest.git'	
                        container('maven') {
				sh 'mvn -B -ntp clean package -DskipTests -pl  samples-common'
                  		sh 'mvn install -pl samples-common'
                         	sh 'mvn -B -ntp clean package -DskipTests -pl  io.seata:samples-business'
                        }
                     }


              }
	      }	
	)
	
	


}


